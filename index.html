<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Titled Code Demo</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root {
      --bg: #0f172a;
      --panel: #111827;
      --text: #e5e7eb;
      --muted: #9ca3af;
      --accent: #22d3ee;
      --border: #1f2937;
      --btn: #0ea5e9;
      --btn-2: #14b8a6;
      --btn-3: #a78bfa;
      --radius: 12px;
    }

    html, body {
      height: 100%;
      background: radial-gradient(1200px 600px at 20% -10%, #1e293b 0%, #0b1020 40%, var(--bg) 100%);
      color: var(--text);
      margin: 0;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, "Helvetica Neue", Arial;
    }

    .wrap {
      max-width: 1100px;
      margin: 40px auto 80px;
      padding: 0 16px;
    }

    header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 12px;
      margin-bottom: 20px;
      flex-wrap: wrap;
    }

    h1 {
      margin: 0;
      font-size: 28px;
      letter-spacing: 0.2px;
    }

    .toolbar {
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
    }

    button {
      border: none;
      border-radius: 10px;
      padding: 10px 14px;
      font-weight: 600;
      cursor: pointer;
      color: white;
      background: var(--btn);
      transition: transform .05s ease, filter .15s ease;
    }
    button:hover { filter: brightness(1.08); }
    button:active { transform: translateY(1px); }
    .btn-green { background: var(--btn-2); }
    .btn-purple { background: var(--btn-3); }

    /* 1 block per row */
    .grid {
      display: grid;
      grid-template-columns: 1fr;
      gap: 24px;
    }

    .block {
      background: linear-gradient(180deg, rgba(255,255,255,0.06), rgba(255,255,255,0.02));
      border: 1px solid var(--border);
      border-radius: var(--radius);
      overflow: hidden;
      box-shadow: 0 10px 24px rgba(0,0,0,.25);
      display: flex;
      flex-direction: column;
      min-height: 400px; /* bigger block height */
    }

    .block-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 10px;
      padding: 12px;
      background: rgba(255,255,255,0.03);
      border-bottom: 1px solid var(--border);
    }

    .title {
      font-size: 15px;
      font-weight: 700;
      outline: none;
      border: none;
      background: transparent;
      color: var(--text);
      padding: 6px 8px;
      border-radius: 8px;
    }

    .code-wrap {
      position: relative;
      padding: 12px;
      flex: 1;
    }

    pre {
      margin: 0;
      overflow: auto;
      height: 100%;
      min-height: 350px; /* larger editable area */
      border-radius: 10px;
      border: 1px solid var(--border);
      background: radial-gradient(1200px 400px at 80% -80%, rgba(80,200,255,0.15), transparent 60%),
                  linear-gradient(180deg, rgba(255,255,255,0.03), rgba(255,255,255,0.01));
      padding: 14px;
      font-size: 14px;
      line-height: 1.5;
      color: #e6edf3;
    }

    code[contenteditable="true"] {
      display: block;
      white-space: pre;
      caret-color: #fff;
      outline: none;
    }

    footer {
      text-align: center;
      margin-top: 26px;
      color: var(--muted);
      font-size: 12px;
    }
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <h1>ðŸŽ¯ TPM TSS Demo</h1>
      <div class="toolbar">
        <button class="btn-green">Add New Block</button>
        <button class="btn-purple">Download All</button>
      </div>
    </header>

    <section class="grid">
      <article class="block">
        <div class="block-header">
          <div class="title" contenteditable="true">C++ Snippet</div>
          <div>
            <button>Copy</button>
            <button class="btn-green">Download</button>
          </div>
        </div>
        <div class="code-wrap">
          <pre><code contenteditable="true">
<!-- Your CODE goes here -->

          </code></pre>
        </div>
      </article>

      <article class="block">
        <div class="block-header">
          <div class="title" contenteditable="true">NULL</div>
          <div>
            <button>Copy</button>
            <button class="btn-green">Download</button>
          </div>
        </div>
        <div class="code-wrap">
          <pre><code contenteditable="true">
            <!-- Your CODE goes here -->
| Step  | Seal to NV sequence                                                                                                                                                                                                                                                                                                               | Unseal to NV sequence                                                                                                                                                                                                                                                                                                                                                     | Seal Object sequence                                                                                                                                                                                                                         | Unseal Object sequence                                                                                                                                                                                  |                                                                                                                                                                                                                                                                          |                                                                                                                                   |                                                                                                                                                                       |             |                                                                                                                                                                                                               |                                                                            |
| ----- | --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ | --------------------------------------------------------------------------------------------------------------------------------- | --------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ----------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | -------------------------------------------------------------------------- |
| **1** | **Open TPM I/O**<br>â€¢ Create TCTI (e.g., `device:/dev/tpmrm0`).<br>â€¢ `Esys_Initialize` â†’ `ESYS_CONTEXT*`.                                                                                                                                                                                                                         | **Open TPM I/O**<br>â€¢ Create TCTI â†’ `Esys_Initialize`.                                                                                                                                                                                                                                                                                                                    | **Open TPM I/O**<br>â€¢ Create TCTI â†’ `Esys_Initialize`.                                                                                                                                                                                       | **Open TPM I/O**<br>â€¢ Create TCTI â†’ `Esys_Initialize`.                                                                                                                                                  |                                                                                                                                                                                                                                                                          |                                                                                                                                   |                                                                                                                                                                       |             |                                                                                                                                                                                                               |                                                                            |
| **2** | **(Optional) Verify support**<br>â€¢ `Esys_GetCapability(TPM2_CAP_ALGS)` to confirm `nameAlg` / PCR bank.                                                                                                                                                                                                                           | **Resolve NV index & learn policy**<br>â€¢ `Esys_TR_FromTPMPublic(nvIndex, &nvHandle)`.<br>â€¢ `Esys_NV_ReadPublic(nvHandle, &pub, &name)` â†’ `dataSize`, `attributes`, `nameAlg`.                                                                                                                                                                                             | **Prepare/obtain parent key**<br>â€¢ Create/reuse SRK:<br>  `Esys_CreatePrimary(ESYS_TR_RH_OWNER, â€¦, &srkHandle)` (or open persistent).                                                                                                        | **Load object under parent**<br>â€¢ If persistent: `Esys_TR_FromTPMPublic(persistentHandle, &child)`.<br>â€¢ Else: `Esys_Load(parentHandle, outPrivate, outPublic, &child)`.                                |                                                                                                                                                                                                                                                                          |                                                                                                                                   |                                                                                                                                                                       |             |                                                                                                                                                                                                               |                                                                            |
| **3** | **(Policy path only) Build policy digest (TRIAL)**<br>â€¢ `Esys_StartAuthSession(..., TPM2_SE_TRIAL, â€¦, nameAlg, &trial)`.<br>â€¢ `Esys_PolicyPCR(trial, pcrSelection)` (bank + indices).<br>â€¢ *(Optional)* `PolicyNV` / `PolicyOR` / `PolicyAuthorize`â€¦<br>â€¢ `Esys_PolicyGetDigest(trial, &authPolicy)`; `Esys_FlushContext(trial)`. | **Authorize for READ**<br>â€¢ If `TPMA_NV_AUTHREAD`: `Esys_TR_SetAuth(nvHandle, &indexAuth)`; use `ESYS_TR_PASSWORD` as `sh1`.<br>â€¢ If `TPMA_NV_POLICYREAD`: start **POLICY** session:<br>  `Esys_StartAuthSession(..., TPM2_SE_POLICY, â€¦, nameAlg, &policy)`; `Esys_PolicyPCR(policy, pcrSelection)`; use `policy` as `sh1`.<br>â€¢ If `OWNERREAD`: auth `ESYS_TR_RH_OWNER`. | **Create policy digest (TRIAL)**<br>â€¢ `Esys_StartAuthSession(..., TPM2_SE_TRIAL, â€¦, nameAlg, &trial)`.<br>â€¢ `Esys_PolicyPCR(trial, pcrSelection)` (+ optional policy steps).<br>â€¢ `Esys_PolicyGetDigest(trial, &authPolicy)`; flush `trial`. | **Start POLICY session for object**<br>â€¢ `Esys_StartAuthSession(..., TPM2_SE_POLICY, â€¦, nameAlg_of_object, &policy)`.<br>â€¢ `Esys_PolicyPCR(policy, pcrSelection)` (must match creation-time selection). |                                                                                                                                                                                                                                                                          |                                                                                                                                   |                                                                                                                                                                       |             |                                                                                                                                                                                                               |                                                                            |
| **4** | **Define NV index**<br>â€¢ Choose handle in `0x01xxxxxx`, `dataSize` (bytes), `nameAlg`.<br>â€¢ Set attributes:<br>  â€“ Password path: \`TPMA\_NV\_AUTHREAD                                                                                                                                                                            | AUTHWRITE                                                                                                                                                                                                                                                                                                                                                                 | NO\_DA`<br>  â€“ Policy path: `TPMA\_NV\_POLICYREAD                                                                                                                                                                                            | POLICYWRITE                                                                                                                                                                                             | NO\_DA`<br>â€¢ (Optional) add `OWNER\*`/`PLATFORM\*`bits for admin overrides.<br>â€¢ Prepare`indexAuth`(PIN/password).<br>â€¢ Owner auth:`Esys\_TR\_SetAuth(esys, ESYS\_TR\_RH\_OWNER, \&ownerAuth)`.<br>â€¢ `Esys\_NV\_DefineSpace(owner, indexAuth, publicInfo, \&nvHandle)\`. | **Read NV**<br>â€¢ Loop `offset` over `dataSize`:<br>  `Esys_NV_Read(authHandle, nvHandle, sh1, â€¦, size, offset, &buf)` and append. | **Create sealed object**<br>â€¢ `TPM2B_SENSITIVE_CREATE`: put data in `sensitive.data`.<br>â€¢ `TPM2B_PUBLIC`: type `TPM2_ALG_KEYEDHASH`, set `nameAlg`, attrs \`fixedTPM | fixedParent | userWithAuth`, `authPolicy`from step 3.<br>â€¢`Esys\_Create(srkHandle, â€¦, \&inSensitive, \&inPublic, â€¦, \&outPrivate, \&outPublic)`.<br>â€¢ *(Optional)* `Esys\_Load`child, then`Esys\_EvictControl\` to persist. | **Unseal**<br>â€¢ `Esys_Unseal(child, policy, â€¦, &secret)` â†’ original bytes. |
| **5** | **Write data**<br>â€¢ Password path: `Esys_TR_SetAuth(nvHandle, &indexAuth)`; use `ESYS_TR_PASSWORD` as `sh1`.<br>â€¢ Policy path: start **POLICY** session â†’ `Esys_PolicyPCR(...)`; use `policy` as `sh1`.<br>â€¢ Chunk to `TPM2_MAX_NV_BUFFER_SIZE` and loop:<br>  `Esys_NV_Write(authHandle, nvHandle, sh1, â€¦, &chunk, offset)`.     | **Cleanup**<br>â€¢ Flush policy (if any), close handle, finalize ESYS.                                                                                                                                                                                                                                                                                                      | **Persist or export**<br>â€¢ Store `outPublic` + `outPrivate` (and parent reference) or persist handle.                                                                                                                                        | **Cleanup**<br>â€¢ `Esys_FlushContext(policy)`; flush child if transient; finalize ESYS.                                                                                                                  |                                                                                                                                                                                                                                                                          |                                                                                                                                   |                                                                                                                                                                       |             |                                                                                                                                                                                                               |                                                                            |
| **6** | **Cleanup**<br>â€¢ `Esys_FlushContext(policy)` (if used).<br>â€¢ `Esys_TR_Close(nvHandle)`.<br>â€¢ `Esys_Finalize`.                                                                                                                                                                                                                     | â€”                                                                                                                                                                                                                                                                                                                                                                         | **Cleanup**<br>â€¢ Flush transient child/parent if not persisting; `Esys_Finalize`.                                                                                                                                                            | â€”                                                                                                                                                                                                       |                                                                                                                                                                                                                                                                          |                                                                                                                                   |                                                                                                                                                                       |             |                                                                                                                                                                                                               |                                                                            |

          </code></pre>
        </div>
      </article>
    </section>

    <footer>Built for quick sharing and personal snippets.</footer>
  </div>
</body>
</html>
